server:
  port: 8080
  servlet:
    context-path: /api

spring:
  application:
    name: lbytech_backend_new
  profiles:
    active: dev
  main:
    allow-circular-references: true # 允许循环依赖
  
  datasource:
    url: jdbc:mysql://${DB_HOST:localhost}:3306/lbytech_backend_new?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:123456}
    # 连接池配置
    hikari:
      minimum-idle: 5
      maximum-pool-size: 15
      connection-timeout: 300000
      dle-timeout: 300000 # 5分钟，空闲连接超时时间
      max-lifetime: 300000 # 5分钟，最大连接生命周期
  
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:1234}
      database: 1

  mail:
    host: ${MAIL_HOST:smtp.163.com}
    port: ${MAIL_PORT:465}
    username: ${MAIL_USERNAME:123@163.com}
    password: ${MAIL_PASSWORD:1234}
    properties:
      mail:
        smtp:
          auth: true
          socketFactory:
            class: javax.net.ssl.SSLSocketFactory
            fallback: false
            port: 465
          ssl:
            enable: true
          connectiontimeout: 5000
          timeout: 5000
          writetimeout: 5000
  pulsar:
    client:
      service-url: pulsar://${PULSAR_ADDRESS:127.0.0.1:6650}

mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl # ??SQL??
    map-underscore-to-camel-case: true # ????????
ali:
  oss:
    endpoint: ${ALI_OSS_ENDPOINT:oss-cn-beijing.aliyuncs.com}
    accessKeyID: ${ALI_OSS_ACCESS_KEY_ID:xxx}
    accessKeySecret: ${ALI_OSS_ACCESS_KEY_SECRET:xxx}
    bucketName: ${ALI_OSS_BUCKET_NAME:xxx}

# springdoc-openapi项目配置
springdoc:
  swagger-ui:
    # swagger-ui 访问路径
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha
    enable: true
  api-docs:
    # OpenAPI JSON端点 路径
    path: /v3/api-docs
    enabled: true
  # 分组配置
  group-configs:
    - group: 'user'
      paths-to-match: '/user/**'
    - group: 'notebook'
      paths-to-match: '/notebook/**'
    - group: 'thumb'
      paths-to-match: '/thumb/**'
    - group: 'es'
      paths-to-match: '/es/**'
    - group: 'ai'
      paths-to-match: '/ai/**'
# knife4j的增强配置，不需要增强可以不配
knife4j:
  enable: true
  setting:
    language: zh_cn
    enable-group: true
    enable-search: true
  # Http验证
  basic:
    enable: true
    username: ${KNF4J_BASIC_USERNAME:admin}
    password: ${KNF4J_BASIC_PASSWORD:123456}

lbytech:
  jwt:
    secret-key: ${JWT_SECRET-KEY}
    token-name: token
    # 单位：ms
    ttl-millis: 7200000
  rag:
    postgres:
      host: ${PG_HOST:localhost}
      port: 5432
      database: lbytech
      username: ${PG_USERNAME:postgres}
      password: ${PG_PASSWORD:password}
      table: rag_embeddings

logging:
  level:
    com.lbytech.lbytech_backend_new: info

test:
  password: ${TEST_PASSWORD:123456}

# prometheus + grafana 配置
management:
  endpoints:
    web:
      exposure:
        include: health, prometheus
  metrics:
    distribution:
      percentiles:
        http:
          server:
            requests: 0.5, 0.75, 0.9, 0.95, 0.99 # http请求的分位数统计

langchain4j:
  open-ai:
    streaming-chat-model:
      base-url: https://api.deepseek.com
      api-key: ${AI_API_KEY}
      model-name: deepseek-chat
      log-requests: true
      log-responses: true
      max-tokens: 5000
    embedding-model:
      base-url: https://dashscope.aliyuncs.com/compatible-mode/v1
      api-key: ${EMBEDDING_API_KEY}
      model-name: ${AI_EMBEDDING_MODEL_NAME:text-embedding-v4}
      log-requests: ${AI_LOG_REQUESTS:true}
      log-responses: ${AI_LOG_RESPONSES:true}
      max-segments-per-batch: 10
      dimensions: 1536
